<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Individual Application Form for Rio Tierra Real Estate developments. Apply to purchase premium residential lots in our exclusive communities.">
    <meta name="keywords" content="individual application, Rio Tierra, residential lots, real estate, Florida Estates, Lunar Estates, property offer">
    <meta name="author" content="Rio Tierra Real Estate">
    <meta property="og:title" content="Rio Tierra | Individual Application Form">
    <meta property="og:description" content="Apply to purchase premium residential lots in Rio Tierra Real Estate's exclusive developments.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="/Rio Tierra Logo.webp">
    <title>Rio Tierra | Individual Application Form</title>
    
    <link rel="preload" href="/Rio Tierra Logo.webp" as="image">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap');
        
        :root {
            --primary: #c1743c;
            --primary-dark: #a85e2d;
            --primary-light: #d4896b;
            --secondary: #2d4a8a;
            --secondary-light: #4a68af;
            --text-dark: #222222;
            --text-medium: #555555;
            --text-light: #888888;
            --border-color: #e0e0e0;
            --border-light: #f5f5f5;
            --bg-light: #fdfaf7;
            --bg-white: #ffffff;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --border-radius: 8px;
            --border-radius-lg: 12px;
            --font-heading: 'Playfair Display', serif;
            --font-body: 'Montserrat', sans-serif;
            --font-signature: 'Dancing Script', cursive;
        }

        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.6;
            color: var(--text-dark);
            background-color: var(--bg-white);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Updated Navbar Styles to match the image */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: #f5f1ed;
            padding: 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .navbar-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-brand {
            text-decoration: none;
            display: flex;
            align-items: center;
            transition: var(--transition);
        }

        .navbar-brand:hover {
            transform: translateY(-2px);
        }

        .navbar-logo {
            height: 60px;
            width: auto;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .navbar-links {
            display: flex;
            list-style: none;
            gap: 50px;
            margin: 0;
            padding: 0;
            align-items: center;
        }

        .navbar-links a {
            text-decoration: none;
            color: var(--text-dark);
            font-weight: 500;
            font-size: 16px;
            transition: var(--transition);
            position: relative;
            padding: 10px 0;
            letter-spacing: 0.02em;
        }

        .navbar-links a:hover {
            color: var(--primary);
        }

        .navbar-links a.active {
            color: var(--primary);
            font-weight: 600;
        }

        .navbar-right {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .navbar-cta {
            background: var(--primary);
            color: #ffffff;
            padding: 12px 30px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 15px;
            transition: var(--transition);
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(193, 116, 60, 0.3);
            letter-spacing: 0.02em;
        }

        .navbar-cta:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(193, 116, 60, 0.4);
        }

        .navbar-cta:active {
            transform: translateY(0);
        }

        .mobile-menu-btn {
            display: none;
            flex-direction: column;
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: var(--transition);
        }

        .mobile-menu-btn:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .mobile-menu-btn span {
            width: 24px;
            height: 2px;
            background: var(--text-dark);
            margin: 3px 0;
            transition: var(--transition);
            border-radius: 1px;
        }

        .mobile-menu-btn.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .mobile-menu-btn.active span:nth-child(2) {
            opacity: 0;
        }

        .mobile-menu-btn.active span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }

        .form-section {
            padding: 120px 0 100px;
            min-height: calc(100vh - 200px);
            background-color: var(--bg-light);
        }

        .form-container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--bg-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            padding: 40px 50px;
            border: 1px solid var(--border-color);
        }

        .form-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 25px;
            border-bottom: 1px solid var(--border-light);
        }

        .form-header h1 {
            font-family: var(--font-heading);
            font-size: 2.8rem;
            color: var(--primary);
            margin-bottom: 15px;
            font-weight: 700;
            letter-spacing: -0.03em;
            line-height: 1.1;
        }

        .form-header p {
            font-size: 1.05rem;
            color: var(--text-medium);
            max-width: 600px;
            margin: 0 auto;
        }

        .document-content {
            font-family: var(--font-body);
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-dark);
            padding: 0 10px;
        }

        .header-text {
            text-align: center;
            font-size: 12px;
            margin-bottom: 25px;
            font-style: italic;
            color: var(--text-light);
        }

        .title {
            text-align: center;
            font-family: var(--font-heading);
            font-weight: 700;
            font-size: 20px;
            color: var(--secondary);
            text-decoration: underline;
            margin-bottom: 30px;
        }

        .section-heading {
            font-family: var(--font-heading);
            font-size: 18px;
            font-weight: 700;
            color: var(--secondary);
            margin-top: 30px;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border-light);
        }

        .seller-line, .property-line {
            margin-bottom: 15px;
            font-size: 14px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .buyer-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 30px;
        }

        .buyer-column {
            background-color: var(--bg-light);
            padding: 25px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-light);
        }

        .buyer-header {
            font-family: var(--font-heading);
            font-weight: 700;
            font-size: 18px;
            color: var(--primary);
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px dashed var(--border-color);
        }

        .field-line {
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            position: relative;
        }

        .field-label {
            margin-right: 10px;
            white-space: nowrap;
            font-weight: 500;
            color: var(--text-medium);
            min-width: 80px;
        }

        .underlined-field {
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--bg-white);
            font-family: var(--font-body);
            font-size: 14px;
            padding: 10px 12px;
            outline: none;
            transition: all 0.2s ease;
            flex-grow: 1;
            min-width: 150px;
            color: var(--text-dark);
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.06);
        }

        .underlined-field:focus {
            border-color: var(--secondary-light);
            box-shadow: 0 0 0 3px rgba(45, 74, 138, 0.1), inset 0 1px 2px rgba(0,0,0,0.06);
            background-color: #f8faff;
        }

        .underlined-field:invalid:not(:placeholder-shown) {
            border-color: #e74c3c;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }

        .underlined-field.error {
            border-color: #e74c3c !important;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1) !important;
        }

        .name-field, .email-field, .address-field {
            min-width: 250px;
        }

        .phone-field, .ssn-field, .military-field, .status-field {
            width: 180px;
            flex-grow: 0;
        }

        .financial-section {
            margin: 30px 0;
        }

        .financial-line {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            position: relative;
        }

        .financial-field {
            width: 160px;
        }

        .term-field {
            width: 70px;
            text-align: center;
        }

        .sample-section {
            background-color: var(--bg-light);
            padding: 25px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-light);
            margin: 30px 0;
        }

        .sample-title {
            font-family: var(--font-heading);
            font-weight: 700;
            font-size: 16px;
            color: var(--primary-dark);
            margin-bottom: 10px;
            text-decoration: underline;
        }

        .sample-details {
            font-size: 13px;
            margin-bottom: 15px;
            color: var(--text-medium);
        }

        .payment-table {
            margin: 15px 0;
            border-collapse: collapse;
            width: 100%;
            font-size: 13px;
        }

        .payment-table td,
        .payment-table th {
            border: 1px solid var(--border-color);
            padding: 10px;
            text-align: center;
        }

        .payment-table th {
            font-weight: 600;
            background-color: var(--border-light);
            color: var(--text-dark);
        }

        .payment-table td {
            background-color: var(--bg-white);
        }

        .disclaimer-text {
            margin: 30px 0;
            font-size: 13px;
            line-height: 1.6;
            text-align: justify;
            color: var(--text-medium);
            padding: 15px;
            border: 1px dashed var(--border-color);
            border-radius: var(--border-radius);
            background-color: #fffaf5;
        }

        .disclaimer-paragraph {
            margin-bottom: 10px;
        }

        .signature-lines {
            margin: 30px 0;
            padding-top: 20px;
            border-top: 1px solid var(--border-light);
        }

        .signature-line {
            margin-bottom: 25px;
            position: relative;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .signature-label {
            font-weight: 600;
            color: var(--text-dark);
            min-width: 120px;
        }

        .signature-underline {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: 1px dashed var(--border-color);
            border-radius: 4px;
            width: 250px;
            height: 45px;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: var(--bg-white);
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.06);
            z-index: 1;
        }

        .signature-underline:hover {
            background-color: #f8faff;
            border-color: var(--secondary-light);
            box-shadow: 0 0 0 3px rgba(45, 74, 138, 0.1);
        }

        .signature-underline:focus {
            outline: none;
            border-color: var(--secondary-light);
            box-shadow: 0 0 0 3px rgba(45, 74, 138, 0.2);
        }

        .signature-underline.has-signature {
            border-color: #28a745;
            background-color: #e6ffe6;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.06), 0 0 0 3px rgba(40, 167, 69, 0.15);
        }

        .signature-underline.has-error {
            border-color: #e74c3c !important;
            background-color: #fff0f0;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.06), 0 0 0 3px rgba(231, 76, 60, 0.15) !important;
        }

        .signature-display {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px;
        }

        .typed-signature {
            font-family: var(--font-signature);
            font-size: 28px;
            color: var(--secondary);
            text-align: center;
            line-height: 1;
            white-space: nowrap;
            transform: translateY(2px);
            user-select: none;
        }

        .drawn-signature {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .date-section {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }

        .date-underline {
            width: 120px;
            text-align: center;
        }

        .mortgage-footer {
            margin-top: 30px;
            text-align: center;
            font-size: 13px;
            border-top: 1px solid var(--border-light);
            padding-top: 20px;
            color: var(--text-light);
        }

        .submit-section {
            margin-top: 40px;
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid var(--border-color);
        }

        .submit-btn {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-light) 100%);
            color: white;
            border: none;
            padding: 15px 35px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            font-family: var(--font-body);
            border-radius: var(--border-radius);
            transition: var(--transition);
            box-shadow: var(--shadow-md);
            letter-spacing: 0.02em;
        }

        .submit-btn:hover {
            background: linear-gradient(135deg, var(--secondary-light) 0%, #1e3d72 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 18px rgba(45, 74, 138, 0.4);
        }

        .submit-btn:focus {
            outline: 3px solid rgba(45, 74, 138, 0.3);
            outline-offset: 3px;
        }

        .submit-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            opacity: 0.7;
        }

        .error-message {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 5px;
            margin-left: 5px;
            display: none;
            flex-basis: 100%;
            text-align: left;
            padding-left: 10px;
        }

        .field-line .error-message {
            position: absolute;
            bottom: -18px;
            left: calc(80px + 10px);
        }

        .field-line:has(input.name-field) .error-message {
            left: 0;
        }

        .status-message {
            font-size: 14px;
            margin-top: 15px;
            font-weight: 500;
            min-height: 20px;
        }

        .status-message.success {
            color: #28a745;
        }

        .status-message.error {
            color: #e74c3c;
        }

        .status-message.loading {
            color: var(--secondary);
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            color: var(--secondary);
            font-weight: 500;
        }

        .spinner {
            border: 3px solid var(--border-light);
            border-top: 3px solid var(--secondary);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease-out forwards;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--bg-white);
            padding: 30px;
            border-radius: var(--border-radius-lg);
            width: 90%;
            max-width: 650px;
            box-shadow: var(--shadow-lg);
            position: relative;
            animation: slideInTop 0.3s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInTop {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-title {
            font-family: var(--font-heading);
            font-size: 24px;
            font-weight: 700;
            color: var(--secondary);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 32px;
            cursor: pointer;
            color: var(--text-light);
            padding: 0;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .close-btn:hover {
            color: #e74c3c;
            transform: scale(1.1);
        }

        .signature-options {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        .option-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--border-color);
            background: var(--bg-white);
            cursor: pointer;
            border-radius: var(--border-radius);
            transition: var(--transition);
            font-weight: 600;
            font-size: 15px;
            color: var(--text-medium);
            box-shadow: var(--shadow-sm);
        }

        .option-btn.active {
            border-color: var(--secondary);
            background: #f0f8ff;
            color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(45, 74, 138, 0.1);
        }

        .option-btn:hover:not(.active) {
            border-color: var(--secondary-light);
            background: var(--border-light);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .signature-input-area {
            margin-bottom: 25px;
        }

        .draw-area {
            display: none;
        }

        .draw-area.active {
            display: block;
        }

        .type-area {
            display: none;
        }

        .type-area.active {
            display: block;
        }

        .modal-signature-canvas {
            width: 100%;
            height: 180px;
            border: 2px solid var(--border-color);
            background: var(--bg-white);
            border-radius: var(--border-radius);
            cursor: crosshair;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.06);
        }

        .modal-signature-canvas:hover {
            border-color: var(--secondary-light);
            box-shadow: 0 0 0 3px rgba(45, 74, 138, 0.1);
        }

        .signature-input {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-family: var(--font-signature);
            font-size: 32px;
            text-align: center;
            color: var(--secondary);
            background: var(--bg-white);
            transition: var(--transition);
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.06);
        }

        .signature-input:focus {
            outline: none;
            border-color: var(--secondary-light);
            box-shadow: 0 0 0 3px rgba(45, 74, 138, 0.1), inset 0 1px 2px rgba(0,0,0,0.06);
        }

        .signature-preview {
            margin-top: 20px;
            padding: 20px;
            border: 1px dashed var(--border-color);
            border-radius: var(--border-radius);
            background: var(--bg-light);
            text-align: center;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            font-size: 14px;
            color: var(--text-light);
        }

        .signature-preview .drawn-signature {
            max-height: 70px;
            width: auto;
        }

        .modal-controls {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .modal-btn {
            padding: 12px 25px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .btn-cancel {
            background: #6c757d;
            color: white;
        }

        .btn-cancel:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-clear {
            background: #e74c3c;
            color: white;
        }

        .btn-clear:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-save {
            background: #28a745;
            color: white;
        }

        .btn-save:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-save:disabled {
            background: #cccccc;
            cursor: not-allowed;
            opacity: 0.7;
            transform: none;
            box-shadow: none;
        }

        /* For PDF generation */
        #pdf-content {
            display: none;
            padding: 40px;
            background: white;
            font-family: Arial, sans-serif;
            line-height: 1.6;
        }

        #pdf-content h1 {
            color: #2d4a8a;
            text-align: center;
            margin-bottom: 30px;
        }

        #pdf-content .section {
            margin-bottom: 25px;
        }

        #pdf-content .field-group {
            margin-bottom: 15px;
        }

        #pdf-content .field-label {
            font-weight: bold;
            display: inline-block;
            width: 150px;
        }

        #pdf-content .signature-section {
            margin-top: 40px;
            border-top: 1px solid #ccc;
            padding-top: 20px;
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .navbar-container {
                padding: 15px 30px;
            }
            
            .navbar-links {
                position: fixed;
                top: 90px;
                left: 0;
                right: 0;
                background: #f5f1ed;
                flex-direction: column;
                padding: 30px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
                transform: translateY(-100%);
                opacity: 0;
                visibility: hidden;
                transition: var(--transition);
                gap: 25px;
            }
            
            .navbar-links.active {
                transform: translateY(0);
                opacity: 1;
                visibility: visible;
            }
            
            .navbar-links a.active::after {
                bottom: -8px;
            }
            
            .mobile-menu-btn {
                display: flex;
            }
            
            .navbar-cta {
                display: none;
            }

            .form-section {
                padding: 100px 0 70px;
            }
            
            .form-container {
                padding: 30px 20px;
                margin: 0 15px;
            }
            
            .form-header h1 {
                font-size: 2.2rem;
            }
            
            .form-header p {
                font-size: 0.95rem;
            }
            
            .document-content {
                padding: 0;
            }
            
            .buyer-section {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .property-line, .financial-line, .signature-line {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .field-line {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .underlined-field {
                width: 100%;
                min-width: unset;
            }
            
            .field-label {
                min-width: unset;
                margin-bottom: 5px;
            }
            
            .phone-field, .ssn-field, .military-field, .status-field, .financial-field, .term-field {
                width: 100%;
                margin-left: 0;
            }
            
            .signature-underline {
                width: 100%;
                margin-left: 0;
            }
            
            .date-section {
                margin-left: 0;
                width: 100%;
                justify-content: flex-start;
            }
            
            .modal-content {
                margin: 10% auto;
                padding: 20px;
            }
            
            .modal-title {
                font-size: 20px;
            }
            
            .signature-input {
                font-size: 24px;
            }
            
            .typed-signature {
                font-size: 24px;
            }
            
            .modal-signature-canvas {
                height: 150px;
            }

            .field-line .error-message {
                position: static;
                margin-top: 2px;
                margin-left: 0;
                padding-left: 0;
            }
        }

        @media (max-width: 480px) {
            .navbar-container {
                padding: 12px 20px;
            }
            
            .navbar-logo {
                height: 45px;
            }
            
            .navbar-links {
                top: 75px;
            }

            .form-container {
                padding: 25px 15px;
                margin: 0 10px;
            }
            
            .form-header h1 {
                font-size: 1.8rem;
            }
            
            .form-header p {
                font-size: 0.9rem;
            }
            
            .submit-btn {
                font-size: 15px;
                padding: 12px 25px;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            html {
                scroll-behavior: auto;
            }
        }
        .signature-underline {
            position: relative;
        }
        
        .signature-display canvas {
            width: 100%;
            height: 100%;
        }
        
        /* Enhanced error styling */
        .error-message {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 5px;
            display: block;
            opacity: 0;
            height: 0;
            transition: all 0.3s ease;
        }
        
        .error-message.show {
            opacity: 1;
            height: auto;
        }
        
        .signature-underline.has-error {
            border-color: #e74c3c;
            background-color: #fff0f0;
        }
        
        /* Loading spinner animation */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Modal positioning fix */
        .modal {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Mobile signature field adjustments */
        @media (max-width: 768px) {
            .signature-line {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .signature-underline {
                width: 100%;
                margin-left: 0;
            }
            
            .date-section {
                margin-left: 0;
                margin-top: 15px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar" role="navigation" aria-label="Main navigation">
        <div class="navbar-container">
            <a href="/" class="navbar-brand" aria-label="Rio Tierra Home">
                <img src="/Rio Tierra Logo.webp" 
                     alt="Rio Tierra Logo" 
                     class="navbar-logo" 
                     width="65" 
                     height="65">
            </a>
            <div class="navbar-links" role="menubar">
                <a href="/" role="menuitem">Home</a>
                <a href="/sales/" role="menuitem">Sales</a>
                <a href="#individual-application" class="active" role="menuitem" aria-current="page">Individual Application</a>
            </div>
            <div class="navbar-right">
                <a href="#individual-application" class="navbar-cta">Apply Now</a>
                <button class="mobile-menu-btn" aria-label="Toggle mobile menu" aria-expanded="false" aria-controls="navbar-links">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </nav>

    <main>
        <section class="form-section" id="individual-application" aria-labelledby="form-heading">
            <div class="container">
                <div class="form-container">
                    <header class="form-header">
                        <h1 id="form-heading">Individual Application Form</h1>
                        <p>Please fill out this form to submit your offer to purchase a vacant property in our exclusive communities.</p>
                    </header>
                    
                    <div class="document-content">
                        <div class="header-text">
                            Your actual rate, payment and costs could be higher. Get an official Loan Estimate before choosing a loan.
                        </div>

                        <h2 class="title">
                            OFFER TO PURCHASE VACANT PROPERTY
                        </h2>

                        <form id="property-form" novalidate>
                            <div class="seller-line">
                                <strong>Seller:</strong> Los Parientes RGV, LLC, P.O. Box 610, McAllen, Texas 78505
                            </div>

                            <div class="property-line">
                                <span class="field-label">Lot#:</span>
                                <input type="text" name="lot" class="underlined-field" style="width: 80px;" required aria-label="Lot number" id="lot">
                                <span class="error-message" id="lot-error">Lot # is required.</span>
                                <span class="field-label">Block#:</span>
                                <input type="text" name="block" class="underlined-field" style="width: 80px;" required aria-label="Block number" id="block">
                                <span class="error-message" id="block-error">Block # is required.</span>
                                <span>Subdivision: Lunar Estates Subdivision Section II, Cameron County, TX</span>
                            </div>

                            <h3 class="section-heading">Buyer Information</h3>
                            <div class="buyer-section">
                                <div class="buyer-column">
                                    <div class="buyer-header">Primary Buyer</div>
                                    
                                    <div class="field-line">
                                        <input type="text" name="buyer_name" class="underlined-field name-field" required 
                                               aria-label="Buyer full name" placeholder="Full Name" id="buyer_name">
                                        <span class="error-message" id="buyer_name-error">Please enter the buyer's full name.</span>
                                    </div>
                                    
                                    <div class="field-line">
                                        <span class="field-label">Email:</span>
                                        <input type="email" name="buyer_email" class="underlined-field email-field" required 
                                               aria-label="Buyer email address" placeholder="email@example.com" id="buyer_email">
                                        <span class="error-message" id="buyer_email-error">Please enter a valid email address.</span>
                                    </div>

                                    <div class="field-line">
                                        <span class="field-label">Address:</span>
                                        <input type="text" name="buyer_address" class="underlined-field address-field" required 
                                               aria-label="Buyer street address" placeholder="Street Address" id="buyer_address">
                                        <span class="error-message" id="buyer_address-error">Street address is required.</span>
                                    </div>

                                    <div class="field-line">
                                        <span class="field-label">City, State, Zip:</span>
                                        <input type="text" name="buyer_city_state_zip" class="underlined-field address-field" required 
                                               aria-label="Buyer city, state, and zip code" placeholder="City, State, Zip" id="buyer_city_state_zip">
                                        <span class="error-message" id="buyer_city_state_zip-error">City, State, and Zip are required.</span>
                                    </div>

                                    <div class="field-line">
                                        <span class="field-label">Phone:</span>
                                        <input type="tel" name="buyer_phone" class="underlined-field phone-field" required 
                                               aria-label="Buyer phone number" placeholder="(XXX) XXX-XXXX" id="buyer_phone">
                                        <span class="error-message" id="buyer_phone-error">Phone number is required.</span>
                                    </div>
                                    <div class="field-line">
                                        <span class="field-label">SSN:</span>
                                        <input type="text" name="buyer_ssn" class="underlined-field ssn-field" required 
                                               aria-label="Buyer Social Security Number" placeholder="XXX-XX-XXXX" id="buyer_ssn">
                                        <span class="error-message" id="buyer_ssn-error">SSN is required.</span>
                                    </div>
                                    <div class="field-line">
                                        <span class="field-label">Military (Y/N):</span>
                                        <input type="text" name="buyer_military" class="underlined-field military-field" aria-label="Buyer military status Yes or No" id="buyer_military">
                                    </div>
                                    <div class="field-line">
                                        <span class="field-label">Marital Status:</span>
                                        <input type="text" name="buyer_marital_status" class="underlined-field status-field" aria-label="Buyer marital status" id="buyer_marital_status">
                                    </div>
                                </div>

                                <div class="buyer-column">
                                    <div class="buyer-header">Co-Buyer (Optional)</div>
                                    
                                    <div class="field-line">
                                        <input type="text" name="cobuyer_name" class="underlined-field name-field" 
                                               aria-label="Co-Buyer full name" placeholder="Full Name" id="cobuyer_name">
                                    </div>
                                    <div class="field-line">
                                        <span class="field-label">Email:</span>
                                        <input type="email" name="cobuyer_email" class="underlined-field email-field" 
                                               aria-label="Co-Buyer email address" placeholder="email@example.com" id="cobuyer_email">
                                    </div>
                                    <div class="field-line">
                                        <span class="field-label">Address:</span>
                                        <input type="text" name="cobuyer_address" class="underlined-field address-field" 
                                               aria-label="Co-Buyer street address" placeholder="Street Address" id="cobuyer_address">
                                    </div>
                                    <div class="field-line">
                                        <span class="field-label">City, State, Zip:</span>
                                        <input type="text" name="cobuyer_city_state_zip" class="underlined-field address-field" 
                                               aria-label="Co-Buyer city, state, and zip code" placeholder="City, State, Zip" id="cobuyer_city_state_zip">
                                    </div>
                                    <div class="field-line">
                                        <span class="field-label">Phone:</span>
                                        <input type="tel" name="cobuyer_phone" class="underlined-field phone-field" 
                                               aria-label="Co-Buyer phone number" placeholder="(XXX) XXX-XXXX" id="cobuyer_phone">
                                    </div>
                                    <div class="field-line">
                                        <span class="field-label">SSN:</span>
                                        <input type="text" name="cobuyer_ssn" class="underlined-field ssn-field" 
                                               aria-label="Co-Buyer Social Security Number" placeholder="XXX-XX-XXXX" id="cobuyer_ssn">
                                    </div>
                                    <div class="field-line">
                                        <span class="field-label">Military (Y/N):</span>
                                        <input type="text" name="cobuyer_military" class="underlined-field military-field" aria-label="Co-Buyer military status Yes or No" id="cobuyer_military">
                                    </div>
                                    <div class="field-line">
                                        <span class="field-label">Marital Status:</span>
                                        <input type="text" name="cobuyer_marital_status" class="underlined-field status-field" aria-label="Co-Buyer marital status" id="cobuyer_marital_status">
                                    </div>
                                </div>
                            </div>

                            <h3 class="section-heading">Financial Details</h3>
                            <div class="financial-section">
                                <div class="financial-line">
                                    <span class="field-label">Purchase Price: $</span>
                                    <input type="number" name="purchase_price" class="underlined-field financial-field" required aria-label="Purchase price" id="purchase_price" step="0.01">
                                    <span class="error-message" id="purchase_price-error">Purchase price is required.</span>
                                </div>
                                <div class="financial-line">
                                    <span class="field-label">Down Payment: $</span>
                                    <input type="number" name="down_payment" class="underlined-field financial-field" required aria-label="Down payment" id="down_payment" step="0.01">
                                    <span class="error-message" id="down_payment-error">Down payment is required.</span>
                                </div>
                                <div class="financial-line">
                                    <span class="field-label">Loan Amount: $</span>
                                    <input type="number" name="loan_amount" class="underlined-field financial-field" required aria-label="Loan amount" id="loan_amount" step="0.01">
                                    <span class="error-message" id="loan_amount-error">Loan amount is required.</span>
                                </div>
                                <div class="financial-line">
                                    <span class="field-label">Interest Rate (%):</span>
                                    <input type="text" name="interest_rate" class="underlined-field financial-field" required aria-label="Interest rate" id="interest_rate" placeholder="e.g., 10%">
                                    <span class="error-message" id="interest_rate-error">Interest rate is required.</span>
                                </div>
                                <div class="financial-line">
                                    <span class="field-label">Monthly Payment: $</span>
                                    <input type="number" name="monthly_payment" class="underlined-field financial-field" required aria-label="Monthly payment" id="monthly_payment" step="0.01">
                                    <span class="error-message" id="monthly_payment-error">Monthly payment is required.</span>
                                </div>
                                <div class="financial-line">
                                    <span class="field-label">Terms:</span>
                                    <input type="number" name="loan_terms_months" class="underlined-field term-field" required aria-label="Loan terms in months" id="loan_terms_months">
                                    <span>Months (</span>
                                    <input type="number" name="loan_terms_years" class="underlined-field term-field" required aria-label="Loan terms in years" id="loan_terms_years">
                                    <span>Years)</span>
                                    <span class="error-message" id="loan_terms_months-error">Loan terms in months are required.</span>
                                    <span class="error-message" id="loan_terms_years-error">Loan terms in years are required.</span>
                                </div>
                            </div>

                            <div class="sample-section">
                                <div class="sample-title">SAMPLE</div>
                                <div class="sample-details">
                                    Terms are based on a purchase price of $50,000, $5,000 down, $45,000 loan, 10% interest, for 10 years
                                </div>
                                <table class="payment-table">
                                    <thead>
                                        <tr>
                                            <th>Loan Amount</th>
                                            <th>Interest</th>
                                            <th>Monthly Payment</th>
                                            <th>Terms</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>$45,000.00</td>
                                            <td>10%</td>
                                            <td>$594.88</td>
                                            <td>120 Months</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="disclaimer-text">
                                <p class="disclaimer-paragraph">
                                    This offer is subject to the review and acceptance by Los Parientes RGV, LLC. All terms and conditions are subject to change based on credit approval and current market rates. Buyer acknowledges that this offer is for vacant land and any future construction will be subject to applicable zoning laws and building codes. Buyer is encouraged to perform their own due diligence regarding the property.
                                </p>
                                <p class="disclaimer-paragraph">
                                    Upon acceptance of this offer, a formal sales contract will be prepared and presented to the Buyer for signature. The down payment is non-refundable unless the offer is rejected by Los Parientes RGV, LLC.
                                </p>
                                <p class="disclaimer-paragraph">
                                    Los Parientes RGV, LLC reserves the right to reject any offer for any reason. This document is an offer and not a binding contract until a formal sales agreement is executed by both parties.
                                </p>
                            </div>

                            <h3 class="section-heading">Signatures</h3>
                            <div class="signature-lines">
                                <div class="signature-line">
                                    <span class="signature-label">Buyer Signature:</span>
                                    <div class="signature-underline" data-signature-for="buyer_signature" id="buyer_signature_line" role="button" tabindex="0" aria-label="Click to sign as Buyer">
                                        <div class="signature-display" id="buyer_signature_display"></div>
                                    </div>
                                    <input type="hidden" name="buyer_signature_data" id="buyer_signature_data">
                                    <div class="date-section">
                                        <span class="field-label">Date:</span>
                                        <input type="text" name="buyer_signature_date" class="underlined-field date-underline" aria-label="Buyer signature date" id="buyer_signature_date" readonly>
                                    </div>
                                    <span class="error-message" id="buyer_signature_line-error">Buyer signature is required.</span>
                                </div>

                                <div class="signature-line">
                                    <span class="signature-label">Co-Buyer Signature:</span>
                                    <div class="signature-underline" data-signature-for="cobuyer_signature" id="cobuyer_signature_line" role="button" tabindex="0" aria-label="Click to sign as Co-Buyer">
                                        <div class="signature-display" id="cobuyer_signature_display"></div>
                                    </div>
                                    <input type="hidden" name="cobuyer_signature_data" id="cobuyer_signature_data">
                                    <div class="date-section">
                                        <span class="field-label">Date:</span>
                                        <input type="text" name="cobuyer_signature_date" class="underlined-field date-underline" aria-label="Co-Buyer signature date" id="cobuyer_signature_date" readonly>
                                    </div>
                                    <span class="error-message" id="cobuyer_signature_line-error">Co-Buyer signature is required.</span>
                                </div>
                            </div>

                            <div class="mortgage-footer">
                                NOT A COMMITMENT TO LEND. Los Parientes RGV, LLC is not a mortgage lender.
                            </div>

                            <div class="submit-section">
                                <div class="loading" style="display: none;">
                                    <div class="spinner"></div>
                                    <p>Submitting your offer...</p>
                                </div>
                                <button type="submit" class="submit-btn" id="form-submit-btn">Submit Offer</button>
                                <p id="property-form-status" class="status-message"></p>
                            </div>
                        </form>
                    </div>

                    <footer class="form-footer">
                        <p>Having trouble with the form? Contact us at <a href="mailto:info@riotierra.com" aria-label="Email Rio Tierra">info@riotierra.com</a> or call <a href="tel:+19565551234" aria-label="Call Rio Tierra">(956) 555-1234</a>.</p>
                    </footer>
                </div>
            </div>
        </section>
    </main>
    
    <div id="signatureModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="signatureModalTitle" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="signatureModalTitle" class="modal-title">Sign Document</h3>
                <button class="close-btn" aria-label="Close signature dialog">&times;</button>
            </div>
            <div class="signature-options">
                <button type="button" id="drawOption" class="option-btn">Draw Signature</button>
                <button type="button" id="typeOption" class="option-btn active">Type Signature</button>
            </div>
            <div class="signature-input-area">
                <div id="drawArea" class="draw-area">
                    <canvas id="signatureCanvas" class="modal-signature-canvas" role="img" aria-label="Drawing area for signature"></canvas>
                </div>
                <div id="typeArea" class="type-area active">
                    <input type="text" id="signatureInput" class="signature-input" placeholder="Type your full name here to sign" aria-label="Type your signature">
                </div>
                <div id="modalSignaturePreview" class="signature-preview">
                    <p>Type your signature above</p>
                </div>
            </div>
            <div class="modal-controls">
                <button type="button" id="clearSignature" class="modal-btn btn-clear">Clear</button>
                <button type="button" id="saveSignature" class="modal-btn btn-save" disabled>Save Signature</button>
                <button type="button" id="cancelSignature" class="modal-btn btn-cancel">Cancel</button>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-top">
            <div class="container">
                <div class="footer-grid">
                    <div class="footer-about">
                        <div class="footer-logo">
                            <img src="/Rio Tierra Logo.webp" alt="Rio Tierra Logo" width="70" height="70">
                        </div>
                        <p class="footer-desc">Rio Tierra Real Estate specializes in creating exceptional communities with a focus on quality, sustainability, and innovative design.</p>
                    </div>
                    <div class="footer-links-container">
                        <h4 class="footer-title">Quick Links</h4>
                        <ul class="footer-links">
                            <li><a href="/">Home</a></li>
                            <li><a href="/sales/">Sales</a></li>
                            <li><a href="#individual-application">Individual Application</a></li>
                        </ul>
                    </div>
                    <div class="footer-links-container">
                        <h4 class="footer-title">Our Communities</h4>
                        <ul class="footer-links">
                            <li><a href="/Lunar-Estates-1/">Lunar Estates - Phase 1</a></li>
                            <li><a href="/Lunar-Estates-2/">Lunar Estates - Phase 2</a></li>
                            <li><a href="/Florida-Estates-2/">Florida Estates - Phase 2</a></li>
                            <li><a href="FEP3.html">Florida Estates - Phase 3</a></li>
                            <li><a href="PGP3S1.html">Palmetto Grove - P3S1</a></li>
                        </ul>
                    </div>
                    <div class="footer-contact">
                        <h4 class="footer-title">Contact Info</h4>
                        <div class="contact-info">
                            <i class="fas fa-envelope contact-icon" aria-hidden="true"></i>
                            <p>info@riotierra.com</p>
                        </div>
                        <div class="contact-info">
                            <i class="fas fa-phone contact-icon" aria-hidden="true"></i>
                            <p>(956) 555-1234</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <div class="container">
                <div class="footer-bottom-content">
                    <p class="copyright">&copy; 2025 Rio Tierra Real Estate. All rights reserved.</p>
                </div>
            </div>
        </div>
        <button id="back-to-top" class="back-to-top-btn" aria-label="Back to top">
            <i class="fas fa-chevron-up" aria-hidden="true"></i>
        </button>
    </footer>

    <script>

// --- Global variables ---
let currentSignatureTargetId = ''; // To keep track of which signature field is being signed (e.g., 'buyer' or 'cobuyer')
let signaturePad = null; // Declare signaturePad globally

document.addEventListener('DOMContentLoaded', () => {
    // --- Get DOM Elements ---

    // Signature boxes (the clickable areas)
    const buyerSignatureLine = document.getElementById('buyer_signature_line');
    const coBuyerSignatureLine = document.getElementById('cobuyer_signature_line');

    // Modal elements
    const signatureModal = document.getElementById('signatureModal');
    const closeModalBtn = signatureModal.querySelector('.close-btn');
    const cancelModalBtn = document.getElementById('cancelSignature'); // Using ID as it's more specific
    const clearSignatureBtn = document.getElementById('clearSignature'); // Using ID
    const saveSignatureBtn = document.getElementById('saveSignature'); // Using ID

    // Tab buttons for Draw/Type
    const drawOptionBtn = document.getElementById('drawOption');
    const typeOptionBtn = document.getElementById('typeOption');

    // Content areas for Draw/Type
    const drawArea = document.getElementById('drawArea');
    const typeArea = document.getElementById('typeArea');

    // Signature input elements within the modal
    const signatureCanvas = document.getElementById('signatureCanvas'); // Corrected ID: 'signatureCanvas'
    const signatureInput = document.getElementById('signatureInput');
    const modalSignaturePreview = document.getElementById('modalSignaturePreview');


    // Only initialize if the canvas element exists and the modal is ready
    if (signatureCanvas) {
 
        const rect = signatureCanvas.getBoundingClientRect();
        signatureCanvas.width = rect.width;
        signatureCanvas.height = rect.height;

        signaturePad = new SignaturePad(signatureCanvas, {
            backgroundColor: 'rgb(255, 255, 255)', // Necessary for clear()
            penColor: 'rgb(0, 0, 0)'
        });

        // Event listener for drawing on the canvas to enable save button
        signaturePad.onEnd = () => {
            saveSignatureBtn.disabled = signaturePad.isEmpty();
            updateModalSignaturePreview();
        };
    }

    // --- Event Listeners ---

    // 1. Click on Buyer/Co-Buyer Signature Boxes to Open Modal
    if (buyerSignatureLine) {
        buyerSignatureLine.addEventListener('click', () => {
            openSignatureModal('buyer'); // 'buyer' is the identifier for the specific signature field
        });
    }

    if (coBuyerSignatureLine) {
        coBuyerSignatureLine.addEventListener('click', () => {
            openSignatureModal('cobuyer'); // 'cobuyer' is the identifier
        });
    }

    // 2. Modal Controls
    if (closeModalBtn) {
        closeModalBtn.addEventListener('click', closeModal);
    }
    if (cancelModalBtn) {
        cancelModalBtn.addEventListener('click', closeModal);
    }
    if (clearSignatureBtn) {
        clearSignatureBtn.addEventListener('click', clearSignatureInModal);
    }
    if (saveSignatureBtn) {
        saveSignatureBtn.addEventListener('click', saveSignature);
    }

    // 3. Tab Switching in Modal
    if (drawOptionBtn && typeOptionBtn) {
        drawOptionBtn.addEventListener('click', () => {
            setActiveTab('draw');
        });
        typeOptionBtn.addEventListener('click', () => {
            setActiveTab('type');
        });
    }

    // 4. Type Signature Input Event (for real-time preview and enabling save)
    if (signatureInput) {
        signatureInput.addEventListener('input', () => {
            saveSignatureBtn.disabled = signatureInput.value.trim() === '';
            updateModalSignaturePreview();
        });
    }

    // --- Functions ---

    /**
     * Opens the signature modal and prepares it for signing.
     * @param {string} target The identifier for which signature field is being signed ('buyer' or 'cobuyer').
     */
    function openSignatureModal(target) {
        currentSignatureTargetId = target; // Store the target

        // Reset modal state
        clearSignatureInModal(); // Clear previous signature data in modal
        signatureModal.style.display = 'flex'; // Make the modal visible!

        // Determine which tab should be active by default or based on existing data
        const signatureDisplayDiv = document.getElementById(`${target}_signature_display`);
        const hiddenSignatureData = document.getElementById(`${target}_signature_data`);

        if (hiddenSignatureData && hiddenSignatureData.value) {
            // If there's existing data, try to re-populate the modal
            const signatureType = hiddenSignatureData.getAttribute('data-signature-type');
            if (signatureType === 'drawn' && signaturePad) {
                setActiveTab('draw');
                // You might want to load the signature onto the canvas here
                // signaturePad.fromDataURL(hiddenSignatureData.value);
            } else if (signatureType === 'typed') {
                setActiveTab('type');
                signatureInput.value = hiddenSignatureData.value;
            }
        } else {
            // Default to the 'type' tab as it was 'active' in your HTML initially
            // If you want 'draw' as default, change 'typeOptionBtn.classList.add('active')' in HTML
            setActiveTab('type');
        }

        // Update preview based on current modal state
        updateModalSignaturePreview();
        // Disable save until new interaction, unless data was pre-filled and valid
        saveSignatureBtn.disabled = !(signaturePad && !signaturePad.isEmpty()) && signatureInput.value.trim() === '';

        // Request animation frame to ensure canvas size is correct after modal becomes visible
        // This is crucial for SignaturePad to correctly draw.
        if (signatureCanvas && drawArea.classList.contains('active')) {
             requestAnimationFrame(() => {
                const rect = signatureCanvas.getBoundingClientRect();
                signatureCanvas.width = rect.width;
                signatureCanvas.height = rect.height;
                signaturePad.clear(); // Clear the canvas again after resize
             });
        }
    }

    /**
     * Hides the signature modal.
     */
    function closeModal() {
        signatureModal.style.display = 'none'; // Hide the modal
        currentSignatureTargetId = ''; // Clear target
        clearSignatureInModal(); // Clear modal content on close
    }

    /**
     * Clears the signature within the modal (both drawn and typed).
     */
    function clearSignatureInModal() {
        if (signaturePad) {
            signaturePad.clear(); // Clear canvas
        }
        signatureInput.value = ''; // Clear typed input
        saveSignatureBtn.disabled = true; // Disable save after clearing
        updateModalSignaturePreview(); // Clear preview
    }

    /**
     * Sets the active tab (Draw or Type) in the signature modal.
     * @param {'draw' | 'type'} tab The tab to activate.
     */
    function setActiveTab(tab) {
        // Remove active class from both tabs and content areas
        drawOptionBtn.classList.remove('active');
        typeOptionBtn.classList.remove('active');
        drawArea.classList.remove('active');
        typeArea.classList.remove('active');

        // Add active class to the selected tab and its content area
        if (tab === 'draw') {
            drawOptionBtn.classList.add('active');
            drawArea.classList.add('active');
            if (signaturePad) {
                // Important: Resize canvas here to ensure it's drawn correctly after switching tabs/modal visibility
                requestAnimationFrame(() => {
                    const rect = signatureCanvas.getBoundingClientRect();
                    signatureCanvas.width = rect.width;
                    signatureCanvas.height = rect.height;
                    signaturePad.clear(); // Clear canvas when switching to drawing
                    // If you want to persist the drawn signature when switching tabs:
                    // signaturePad.fromData(signaturePad.toData());
                });
            }
        } else { // 'type'
            typeOptionBtn.classList.add('active');
            typeArea.classList.add('active');
            signatureInput.focus(); // Focus input for typing
        }
        updateModalSignaturePreview(); // Update preview after tab change
    }

    /**
     * Updates the signature preview in the modal based on current input.
     */
    function updateModalSignaturePreview() {
        if (!modalSignaturePreview) return;

        modalSignaturePreview.innerHTML = ''; // Clear existing preview

        if (drawArea.classList.contains('active') && signaturePad && !signaturePad.isEmpty()) {
            const dataURL = signaturePad.toDataURL();
            const img = document.createElement('img');
            img.src = dataURL;
            img.classList.add('drawn-signature'); // Add class for styling
            modalSignaturePreview.appendChild(img);
        } else if (typeArea.classList.contains('active') && signatureInput.value.trim() !== '') {
            const span = document.createElement('span');
            span.textContent = signatureInput.value.trim();
            span.classList.add('typed-signature'); // Add class for styling
            modalSignaturePreview.appendChild(span);
        } else {
            // Add a default placeholder if nothing is entered
            const p = document.createElement('p');
            p.textContent = drawArea.classList.contains('active') ? 'Draw your signature above' : 'Type your signature above';
            modalSignaturePreview.appendChild(p);
        }
    }

    /**
     * Saves the signature data to the appropriate form fields and closes the modal.
     */
    function saveSignature() {
        if (!currentSignatureTargetId) return;

        // Get the relevant elements for the current buyer/cobuyer
        const signatureDisplayDiv = document.getElementById(`${currentSignatureTargetId}_signature_display`);
        const hiddenSignatureDataInput = document.getElementById(`${currentSignatureTargetId}_signature_data`);
        const signatureDateInput = document.getElementById(`${currentSignatureTargetId}_signature_date`);
        const signatureErrorSpan = document.getElementById(`${currentSignatureTargetId}_signature_line-error`);
        const signatureBox = document.getElementById(`${currentSignatureTargetId}_signature_line`);

        signatureDisplayDiv.innerHTML = ''; // Clear previous content in the main form

        let signatureData = '';
        let signatureType = '';
        let isSignatureValid = false;

        if (drawArea.classList.contains('active') && signaturePad && !signaturePad.isEmpty()) {
            // Save drawn signature
            signatureData = signaturePad.toDataURL('image/png');
            signatureType = 'drawn';
            const img = document.createElement('img');
            img.src = signatureData;
            img.classList.add('drawn-signature');
            signatureDisplayDiv.appendChild(img);
            isSignatureValid = true;
        } else if (typeArea.classList.contains('active') && signatureInput.value.trim() !== '') {
            // Save typed signature
            signatureData = signatureInput.value.trim();
            signatureType = 'typed';
            const span = document.createElement('span');
            span.textContent = signatureData;
            span.classList.add('typed-signature'); // Apply signature font if defined in CSS
            signatureDisplayDiv.appendChild(span);
            isSignatureValid = true;
        }

        if (isSignatureValid) {
            // Store data in the hidden input
            if (hiddenSignatureDataInput) {
                hiddenSignatureDataInput.value = signatureData;
                hiddenSignatureDataInput.setAttribute('data-signature-type', signatureType);
            }

            // Set the current date
            const today = new Date();
            const dd = String(today.getDate()).padStart(2, '0');
            const mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
            const yyyy = today.getFullYear();
            if (signatureDateInput) {
                signatureDateInput.value = `${mm}/${dd}/${yyyy}`;
            }

            // Update main signature box appearance for validation/styling
            if (signatureBox) {
                signatureBox.classList.add('has-signature');
                signatureBox.classList.remove('has-error');
            }
            if (signatureErrorSpan) {
                signatureErrorSpan.classList.remove('show'); // Hide error message
                signatureErrorSpan.textContent = '';
            }

            closeModal(); // Close the modal after saving
        } else {
            // If no valid signature, show error on the main form
            if (signatureErrorSpan) {
                signatureErrorSpan.textContent = 'Signature is required.';
                signatureErrorSpan.classList.add('show');
            }
            if (signatureBox) {
                signatureBox.classList.add('has-error');
            }
        }
    }
});

    </script>
</body>
</html>
